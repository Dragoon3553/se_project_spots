!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__btn",inactiveButtonClass:"modal__btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):o(t,r)},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},o=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)};function a(e,t,r="Save",n="Saving..."){t.textContent=e?n:r}function s(e,t,r="Saving..."){t.preventDefault();const n=t.submitter,o=n.textContent;a(!0,n,o,r),e().then(()=>{t.target.reset()}).catch(console.error).finally(()=>{a(!1,n,o)})}const c=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}postUserCards({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"e804bb37-0140-4fc9-a9c2-b227c76ecbad","Content-Type":"application/json"}});c.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=w(e);$.append(t)}),d.src=t.avatar,i.textContent=t.name,l.textContent=t.about}).catch(console.error);const i=document.querySelector(".profile__name"),l=document.querySelector(".profile__description"),d=document.querySelector(".profile__avatar"),u=document.querySelector("#edit-profile-modal"),m=document.querySelector("#new-post-modal"),_=document.querySelector("#preview-modal"),h=document.querySelector(".profile__avatar-container"),f=document.querySelector("#avatar-modal"),v=f.querySelector("#profile-avatar-input"),p=f.querySelector(".modal__form"),y=document.querySelector("#delete-modal"),S=y.querySelector(".modal__form"),b=y.querySelector(".modal__btn_type_cancel"),q=u.querySelector(".modal__form"),k=u.querySelector("#profile-name-input"),E=u.querySelector("#profile-description-input"),L=m.querySelector(".modal__form"),C=m.querySelector("#card-image-input"),g=m.querySelector("#card-caption-input"),U=_.querySelector(".modal__img"),x=_.querySelector(".modal__caption"),A=document.querySelector("#card-template"),$=document.querySelector(".cards__list");let I,R;const T=document.querySelector(".profile__edit-btn"),P=document.querySelector(".profile__add-btn");function w(e){const t=A.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return e.isLiked&&o.classList.add("card__like-btn_active"),r.textContent=e.name,n.src=e.link,n.alt=e.name,n.addEventListener("click",()=>function({link:e,name:t}){U.src=e,U.alt=t,x.textContent=t,D(_)}(e)),o.addEventListener("click",t=>function(e,t){const r=e.target.classList.contains("card__like-btn_active");c.changeLikeStatus(t,r).then(()=>{e.target.classList.toggle("card__like-btn_active")}).catch(console.error)}(t,e._id)),a.addEventListener("click",()=>function(e,t){I=e,R=t,D(y)}(t,e._id)),t}function B(e){"Escape"===e.key&&N(document.querySelector(".modal_is-opened"))}function D(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",B)}function N(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",B)}var O;m.querySelector(".modal__btn"),document.querySelectorAll(".modal__close-btn").forEach(e=>{const t=e.closest(".modal");e.addEventListener("click",()=>N(t))}),b.addEventListener("click",()=>N(y)),T.addEventListener("click",()=>{var r,n;D(u),k.value=i.textContent,E.value=l.textContent,r=q,n=e,[k,E].forEach(e=>{t(r,e,n)})}),P.addEventListener("click",()=>{D(m)}),h.addEventListener("click",()=>{D(f)}),p.addEventListener("submit",function(t){s(function(){return c.editAvatarInfo({avatar:v.value}).then(r=>{d.src=r.avatar,N(f),n(t.submitter,e)})},t)}),q.addEventListener("submit",function(t){s(function(){return c.editUserInfo({name:k.value,about:E.value}).then(r=>{i.textContent=r.name,l.textContent=r.about,N(u),n(t.submitter,e)})},t)}),S.addEventListener("submit",function(e){s(function(){return c.deleteCard(R).then(()=>{I.remove(),N(y)})},e,"Deleting...")}),L.addEventListener("submit",function(t){const r={name:g.value,link:C.value};s(function(){return c.postUserCards(r).then(r=>{const o=w(r);$.prepend(o),n(t.submitter,e),N(m)})},t)}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",function(t){t.target===e&&N(t.target)})}),O=e,Array.from(document.querySelectorAll(O.formSelector)).forEach(e=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)})})})(e,O)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxHQUNwQ0EsRUFBRTlGLFNBQVdpRyxHQUNmRCxFQUFXRixFQUFFOUYsT0FFakIsS0YzRjZCL0IsRUVpTGhCVixFRmhMRW9KLE1BQU1DLEtBQUt4RCxTQUFTK0MsaUJBQWlCbEksRUFBT1QsZUFDcERrRixRQUFTM0UsSUFoQk04SSxFQUFDOUksRUFBUUUsS0FDakMsTUFBTU8sRUFBWW1JLE1BQU1DLEtBQUs3SSxFQUFPb0ksaUJBQWlCbEksRUFBT1IsZ0JBQ3REZ0IsRUFBV1YsRUFBT0csY0FBY0QsRUFBT1Asc0JBRTdDYSxFQUFrQkMsRUFBV0MsRUFBVVIsR0FFdkNPLEVBQVVrRSxRQUFTMUUsSUFDakJBLEVBQVFvSCxpQkFBaUIsUUFBUyxXQTVDWDBCLEVBQUMvSSxFQUFRQyxFQUFTQyxLQUN0Q0QsRUFBUVksU0FBU0MsTUFHcEJmLEVBQWVDLEVBQVFDLEVBQVNDLEdBaEJiOEksRUFBQ2hKLEVBQVFDLEVBQVNnSixFQUFVL0ksS0FDOUJGLEVBQU9HLGNBQWMsSUFBSUYsRUFBUUcsWUFDekNDLFlBQWM0SSxFQUN6QmhKLEVBQVFLLFVBQVVhLElBQUlqQixFQUFPTCxrQkFXM0JtSixDQUFlaEosRUFBUUMsRUFBU0EsRUFBUWlKLGtCQUFtQmhKLElBMkN6RDZJLENBQW1CL0ksRUFBUUMsRUFBU0MsR0FDcENNLEVBQWtCQyxFQUFXQyxFQUFVUixFQUN6QyxNQU9BNEksQ0FBa0I5SSxFQUFRRSxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idG5faW5hY3RpdmVcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0LCBjb25maWcpKSB7XG4gICAgZGlzYWJsZWRCdG4oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgZW5hYmxlZEJ0bihidXR0b25FbCwgY29uZmlnKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVkQnRuID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5jb25zdCBlbmFibGVkQnRuID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG4iLCJleHBvcnQgZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhcbiAgaXNMb2FkaW5nLFxuICBidG4sXG4gIGJ1dHRvblRleHQgPSBcIlNhdmVcIixcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXG4pIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGJ1dHRvblRleHQ7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChyZXF1ZXN0LCBldnQsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCBpbml0aWFsVGV4dCA9IHN1Ym1pdEJ0bi50ZXh0Q29udGVudDtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ0biwgaW5pdGlhbFRleHQsIGxvYWRpbmdUZXh0KTtcblxuICByZXF1ZXN0KClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdG4sIGluaXRpYWxUZXh0KTtcbiAgICB9KTtcbn1cbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlZEJ0bixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyByZW5kZXJMb2FkaW5nLCBoYW5kbGVTdWJtaXQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuXG4vLyBBcGlcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImU4MDRiYjM3LTAxNDAtNGZjOS1hOWMyLWIyMjdjNzZlY2JhZFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJzXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gdXNlcnMuYXZhdGFyO1xuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlcnMuYWJvdXQ7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy8gUHJvZmlsZVxuY29uc3QgcHJvZmlsZU5hbWVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuXG4vLyBNb2RhbHNcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5cbi8vIEF2YXRhciBmb3JtIGVsZW1lbnRzXG5jb25zdCBhdmF0YXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1jb250YWluZXJcIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuY29uc3QgYXZhdGFyRm9ybSA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbi8vIERlbGV0ZSBmb3JtIGVsZW1lbnRzXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBkZWxldGVDYW5jZWxCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idG5fdHlwZV9jYW5jZWxcIik7XG5cbi8vIEZvcm1zIC8gSW5wdXRzXG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBlZGl0UHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcbik7XG5jb25zdCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcblxuY29uc3QgbmV3UG9zdEZvcm0gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IHBvc3RMaW5rSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltYWdlLWlucHV0XCIpO1xuY29uc3QgcG9zdE5hbWVJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtY2FwdGlvbi1pbnB1dFwiKTtcblxuLy8gUHJldmlldyBtb2RhbCBFbGVtZW50c1xuY29uc3QgbW9kYWxJbWdFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWdcIik7XG5jb25zdCBtb2RhbENhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBDYXJkIExpc3RcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5sZXQgc2VsZWN0ZWRDYXJkLCBzZWxlY3RlZENhcmRJZDtcblxuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idG5cIik7XG5cbmNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmRUaXRsZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gIH1cblxuICBjYXJkVGl0bGVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZUltYWdlQ2xpY2soZGF0YSkpO1xuICBjYXJkTGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZShldnQsIGRhdGEuX2lkKSk7XG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXG4gICk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLyBGdW5jdGlvbnNcbmZ1bmN0aW9uIGFkZEVzY2FwZUxpc3RlbmVyKGUpIHtcbiAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgbW9kYWxFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGNsb3NlTW9kYWwobW9kYWxFbCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGlkKSB7XG4gIGNvbnN0IGlzTGlrZWQgPSBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgYXBpXG4gICAgLmNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gIHNlbGVjdGVkQ2FyZElkID0gY2FyZElkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVJbWFnZUNsaWNrKHsgbGluaywgbmFtZSB9KSB7XG4gIG1vZGFsSW1nRWwuc3JjID0gbGluaztcbiAgbW9kYWxJbWdFbC5hbHQgPSBuYW1lO1xuICBtb2RhbENhcHRpb25FbC50ZXh0Q29udGVudCA9IG5hbWU7XG4gIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgYWRkRXNjYXBlTGlzdGVuZXIpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGFkZEVzY2FwZUxpc3RlbmVyKTtcbn1cblxuY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICBjb25zdCBwb3B1cCA9IGJ1dHRvbi5jbG9zZXN0KFwiLm1vZGFsXCIpO1xuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwocG9wdXApKTtcbn0pO1xuXG5kZWxldGVDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpKTtcblxuZnVuY3Rpb24gY2xvc2VPbk92ZXJsYXkoKSB7XG4gIGNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG4gIG1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0ID09PSBtb2RhbCkge1xuICAgICAgICBjbG9zZU1vZGFsKGUudGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmVkaXRQcm9maWxlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybSxcbiAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbn0pO1xuXG5uZXdQb3N0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbi8vIEF2YXRhciBFdmVudExpc3RlbmVyc1xuYXZhdGFyQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdCk7XG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlRWRpdFByb2ZpbGVTdWJtaXQoZXZ0KSB7XG4gIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xuICAgIHJldHVybiBhcGlcbiAgICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgICBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgICAgYWJvdXQ6IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICAgIH0pXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICAgIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gICAgICAgIGRpc2FibGVkQnRuKGV2dC5zdWJtaXR0ZXIsIHNldHRpbmdzKTtcbiAgICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xuICBmdW5jdGlvbiBtYWtlUmVxdWVzdCgpIHtcbiAgICByZXR1cm4gYXBpLmVkaXRBdmF0YXJJbmZvKHsgYXZhdGFyOiBhdmF0YXJJbnB1dC52YWx1ZSB9KS50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICAgIGRpc2FibGVkQnRuKGV2dC5zdWJtaXR0ZXIsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfVxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZnVuY3Rpb24gbWFrZVJlcXVlc3QoKSB7XG4gICAgcmV0dXJuIGFwaS5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKS50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCBcIkRlbGV0aW5nLi4uXCIpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xuICBjb25zdCBpbnB1dFZhbHVlcyA9IHtcbiAgICBuYW1lOiBwb3N0TmFtZUlucHV0LnZhbHVlLFxuICAgIGxpbms6IHBvc3RMaW5rSW5wdXQudmFsdWUsXG4gIH07XG4gIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xuICAgIHJldHVybiBhcGkucG9zdFVzZXJDYXJkcyhpbnB1dFZhbHVlcykudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcblxuICAgICAgZGlzYWJsZWRCdG4oZXZ0LnN1Ym1pdHRlciwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0KTtcbn1cblxubmV3UG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcblxuY2xvc2VPbk92ZXJsYXkoKTtcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgcG9zdFVzZXJDYXJkcyh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZEJ0biIsImVuYWJsZWRCdG4iLCJkaXNhYmxlZCIsImFkZCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJidG4iLCJidXR0b25UZXh0IiwibG9hZGluZ1RleHQiLCJoYW5kbGVTdWJtaXQiLCJyZXF1ZXN0IiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdG4iLCJzdWJtaXR0ZXIiLCJpbml0aWFsVGV4dCIsInRoZW4iLCJ0YXJnZXQiLCJyZXNldCIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImFwaSIsImNvbnN0cnVjdG9yIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImZldGNoIiwicG9zdFVzZXJDYXJkcyIsIm5hbWUiLCJsaW5rIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0VXNlckluZm8iLCJhYm91dCIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiZGVsZXRlQ2FyZCIsImNoYW5nZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlcnMiLCJmb3JFYWNoIiwiaXRlbSIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJjYXJkc0xpc3QiLCJhcHBlbmQiLCJwcm9maWxlQXZhdGFyRWwiLCJzcmMiLCJwcm9maWxlTmFtZUVsIiwicHJvZmlsZURlc2NyaXB0aW9uRWwiLCJkb2N1bWVudCIsImVkaXRQcm9maWxlTW9kYWwiLCJuZXdQb3N0TW9kYWwiLCJwcmV2aWV3TW9kYWwiLCJhdmF0YXJDb250YWluZXIiLCJhdmF0YXJNb2RhbCIsImF2YXRhcklucHV0IiwiYXZhdGFyRm9ybSIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsImRlbGV0ZUNhbmNlbEJ0biIsImVkaXRQcm9maWxlRm9ybSIsImVkaXRQcm9maWxlTmFtZUlucHV0IiwiZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwibmV3UG9zdEZvcm0iLCJwb3N0TGlua0lucHV0IiwicG9zdE5hbWVJbnB1dCIsIm1vZGFsSW1nRWwiLCJtb2RhbENhcHRpb25FbCIsImNhcmRUZW1wbGF0ZSIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiZWRpdFByb2ZpbGVCdG4iLCJuZXdQb3N0QnRuIiwiZGF0YSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VCdG4iLCJjYXJkRGVsZXRlQnRuIiwiYWx0IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW5Nb2RhbCIsImhhbmRsZUltYWdlQ2xpY2siLCJjb250YWlucyIsInRvZ2dsZSIsImhhbmRsZUxpa2UiLCJfaWQiLCJjYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiYWRkRXNjYXBlTGlzdGVuZXIiLCJlIiwia2V5IiwiY2xvc2VNb2RhbCIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJwb3B1cCIsImNsb3Nlc3QiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsImlucHV0VmFsdWVzIiwicHJlcGVuZCIsIkFycmF5IiwiZnJvbSIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==